---
title: 'Pythã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã‚’æ´»ç”¨ã—ãŸBerachainã«ãŠã‘ã‚‹å…¬å¹³ãªNFTãƒ©ãƒ³ãƒ€ãƒ ãƒŸãƒ³ãƒˆ [Berachainç¿»è¨³]'
tags:
  - Blockchain
  - Ethereum
  - Web3
  - Berachain
  - SunriseLayer
private: false
updated_at: '2024-09-10T16:41:32+09:00'
id: 5d46347c899bb5ba698f
organization_url_name: sunriselayer
slide: false
ignorePublish: false
---
:::note info
æœ¬è¨˜äº‹ã¯ä¸‹è¨˜ã®ç¿»è¨³ã¨ãªã‚Šã¾ã™ã€‚
[ã€Fair Random NFT Mints with Pyth Entropy on Berachainã€](https://blog.berachain.com/blog/fair-random-nft-mints-with-pyth-entropy-on-berachain)
:::

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1926720/f9afbe57-d1b4-f221-50ee-85a5879d85aa.png)

## Pyth ã‚’ä½¿ç”¨ã—ã¦å…¬å¹³ã«ãƒŸãƒ³ãƒˆã•ã‚ŒãŸ NFT ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹

[**_Pyth Entropy_**](https://docs.pyth.network/entropy?ref=berachain.ghost.io)ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€é–‹ç™ºè€…ã¯ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸Šã§å®‰å…¨ãªä¹±æ•°ã‚’ç°¡å˜ã«ç”Ÿæˆã§ãã¾ã™ã€‚

æ¤œè¨¼å¯èƒ½ãªãƒ©ãƒ³ãƒ€ãƒ æ€§ã¯ã€NFT ã«æœ‰ç”¨ãªå¿œç”¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚»ãƒƒãƒˆå†…ã®ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã®ä½ç½®ã«é–¢ã™ã‚‹äº‹å‰çŸ¥è­˜ï¼ˆä¾‹ï¼šå†…éƒ¨æƒ…å ±ã‚„èª¿æŸ»ã‚’é€šã˜ã¦ï¼‰ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã¯ã€ãƒŸãƒ³ãƒˆã®å…¬å¹³æ€§ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«å¯¾æŠ—ã™ã‚‹åŠ¹æœçš„ãªæ–¹æ³•ã¯ã€ãƒŸãƒ³ãƒˆã‚’å®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ ã«é…å¸ƒã™ã‚‹ã“ã¨ã§ã™ã€‚ã»ã¨ã‚“ã©ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®æ±ºå®šè«–çš„ãªæ€§è³ªã«ã‚ˆã‚Šã€çœŸã®ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã«å¾—ã‚‹ã“ã¨ã¯å›°é›£ã§ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€Pyth Entropy ã‚’æ´»ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦æ¤œè¨¼å¯èƒ½ãªå…¬å¹³æ€§ã‚’æŒã¤ NFT ãƒŸãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

---

## ğŸ“‹ è¦ä»¶

å…ˆã«é€²ã‚€å‰ã«ã€ä»¥ä¸‹ã®ã‚‚ã®ãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŠã‚ˆã³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- Node `v20.11.0` ä»¥ä¸Š
- [pnpm](https://pnpm.io/installation?ref=berachain.ghost.io)
- [**Berachain Artio ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**](https://docs.berachain.com/developers/?ref=berachain.ghost.io)ã§è¨­å®šã•ã‚ŒãŸã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
- ãã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆå†…ã® `$BERA` ã¾ãŸã¯ Berachain ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ â€” [**_Berachain Faucet_**](http://artio.faucet.berachain.com/?ref=berachain.ghost.io)ã‚’å‚ç…§ã—ã¦ãã ã•ã„

### Foundry

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ Foundry ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```terminal
curl -L https://foundry.paradigm.xyz | bash;

foundryup;

# foundryup installs the 'forge' and 'cast' binaries, used later
```

_Installing Foundry To Your Computer_

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€Foundry ã®[ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰](https://book.getfoundry.sh/getting-started/installation?ref=berachain.ghost.io)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚Berachain ã§ Foundry ã‚’ä½¿ç”¨ã™ã‚‹è©³ç´°ã«ã¤ã„ã¦ã¯ã€ã“ã¡ã‚‰ã®[ã‚¬ã‚¤ãƒ‰](https://docs.berachain.com/developers/guides/create-erc20-contract-using-foundry?ref=berachain.ghost.io)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## Pyth Entropy ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ã¾ãšã€Foundry ã‚’ä½¿ã£ã¦é–‹ç™ºç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

ã¾ãšæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€Foundry ã‚’åˆæœŸåŒ–ã—ã¾ã™ï¼š

```terminal
forge init pyth-entropy --no-git --no-commit;

cd pyth-entropy;

# We observe the following basic layout
# .
# â”œâ”€â”€ foundry.toml
# â”œâ”€â”€ script
# â”‚   â””â”€â”€ Counter.s.sol
# â”œâ”€â”€ src
# â”‚   â””â”€â”€ Counter.sol
# â””â”€â”€ test
#     â””â”€â”€ Counter.t.sol
```

_Initial Forge Project Template_

### ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã„ãã¤ã‹ã®ä¾å­˜é–¢ä¿‚ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€ä»¥ä¸‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

```terminal
# FROM: ./pyth-entropy

pnpm init;
pnpm add web3 dotenv @pythnetwork/entropy-sdk-solidity @openzeppelin/contracts --ignore-workspace;

# web3 - interact with EVM blockchains with JavaScript
# dotenv - manage environment variables
# @pythnetwork/entropy-sdk-solidity - Pyth Entropy interfaces
# @openzeppelin/contracts - audited smart contract libraries
```

_Install Contract Dependencies & SDKs_

Forge ã¯ä¾å­˜é–¢ä¿‚ã‚’å†ãƒãƒƒãƒ—ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ã‚ˆã‚Šèª­ã¿ã‚„ã™ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã§ã¯ã€Solidity ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å†ãƒãƒƒãƒ—ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```terminal
# FROM: ./pyth-entropy

echo "remappings = ['@pythnetwork/entropy-sdk-solidity/=node_modules/@pythnetwork/entropy-sdk-solidity', '@openzeppelin/contracts/=node_modules/@openzeppelin/contracts']" >> ./foundry.toml
```

_Foundry Toml File For Remapping_

### NFT ãƒŸãƒ³ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä½œæˆ

Pyth ã‚’ä½¿ç”¨ã—ã¦ Solidity ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§æ¤œè¨¼å¯èƒ½ãªãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ« `./src/EntropyNFT.sol` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ï¼š

```solidity
pragma solidity ^0.8.13;

import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@pythnetwork/entropy-sdk-solidity/IEntropy.sol";
import "@pythnetwork/entropy-sdk-solidity/IEntropyConsumer.sol";

contract EntropyNFT is ERC721Enumerable, IEntropyConsumer {
    event NumberRequested(uint64 sequenceNumber, address minter);
    event Minted(uint64 sequenceNumber, address minter, uint256 tokenId);

    IEntropy entropy;
    address provider;
    uint256 public constant MAX_SUPPLY = 500;
    uint256 public nextIndex;
    uint256[] private availableTokenIds;

    // Mapping of sequence numbers to minter addresses
    mapping(uint64 => address) public sequenceNumberToMinter;

    constructor(
        address _entropy,
        address _provider
    ) ERC721("EntropyNFT", "eNFT") {
        entropy = IEntropy(_entropy);
        provider = _provider;
        initializeAvailableTokenIds();
    }

    // Step 1 of 2: Request a new random number for minting
    // Returns sequence number used to obtain random number from Pyth
    function requestMint(bytes32 userRandomNumber) external payable {
        require(nextIndex < MAX_SUPPLY, "Reached max supply");

        uint128 requestFee = entropy.getFee(provider);
        require(msg.value >= requestFee, "not enough fees");

        uint64 sequenceNumber = entropy.requestWithCallback{value: requestFee}(
            provider,
            userRandomNumber
        );

        sequenceNumberToMinter[sequenceNumber] = msg.sender;

        emit NumberRequested(sequenceNumber, msg.sender);
    }

    // Step 2 of 2: Fulfill mint request on Pyth callback
    function entropyCallback(
        uint64 sequenceNumber,
        address,
        bytes32 randomNumber
    ) internal override {
        address minter = sequenceNumberToMinter[sequenceNumber];
        uint256 randomIndex = uint256(randomNumber) % availableTokenIds.length;
        uint256 tokenId = availableTokenIds[randomIndex];

        // Swap-and-pop to replace minted tokenId
        availableTokenIds[randomIndex] = availableTokenIds[
            availableTokenIds.length - 1
        ];
        availableTokenIds.pop();
        nextIndex++;

        _safeMint(minter, tokenId);
        emit Minted(sequenceNumber, minter, tokenId);
    }

    // Initialize array of available token IDs
    function initializeAvailableTokenIds() private {
        for (uint256 i = 0; i < MAX_SUPPLY; i++) {
            availableTokenIds.push(i);
        }
    }

    // This method is required by the IEntropyConsumer interface
    function getEntropy() internal view override returns (address) {
        return address(entropy);
    }
}
```

ã§ã¯ã€ã“ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’è©³ã—ãè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼š

`EntropyNFT` ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯ `ERC721Enumerable` ã‚’ç¶™æ‰¿ã—ã€æ¨™æº–çš„ãª NFT æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€ã“ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯ `IEntropyConsumer `ã‚’ç¶™æ‰¿ã—ã¦ãŠã‚Šã€ã“ã‚Œã¯ãƒ©ãƒ³ãƒ€ãƒ æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæº€ãŸã•ã‚ŒãŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
`IEntropy.sol` ã¯ã€`Pyth Entropy` ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨ç›¸äº’ä½œç”¨ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°`_entropy` ã¯ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ Entropy ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¾ã™ã€‚
ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¯æœ€å¤§ä¾›çµ¦é‡ã‚’ 500 NFT ã¨å®šç¾©ã—ã€`availableTokenIds` é…åˆ—ã‚’[0â€¦499]ã§åˆæœŸåŒ–ã—ã¾ã™ã€‚
**requestMint**é–¢æ•°ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆï¼ˆè©³ç´°ã¯å¾Œè¿°ï¼‰ã‚’æä¾›ã—ã€å¿…è¦ãªæ‰‹æ•°æ–™ã‚’æ”¯æ‰•ã†ã“ã¨ã§ã€`Entropy` ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ æ•°ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚è¿”ã•ã‚ŒãŸ `sequenceNumber` ã¯ã€ãã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã«å¯¾å¿œã™ã‚‹ãƒ©ãƒ³ãƒ€ãƒ æ•°ã§ NFT ã‚’ãƒŸãƒ³ãƒˆã™ã‚‹æ¨©åˆ©ã‚’å‘¼ã³å‡ºã—å…ƒã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ã‘ã—ã¾ã™ã€‚
**entropyCallback**é–¢æ•°ã¯ã€åˆ†æ•£å‹ã‚­ãƒ¼ãƒ‘ãƒ¼ãƒœãƒƒãƒˆãŒãƒ©ãƒ³ãƒ€ãƒ æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æº€ãŸã—ãŸæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã€æœ€çµ‚çš„ã«å›ºæœ‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ ID ã§ NFT ã‚’ãƒŸãƒ³ãƒˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ©ãƒ³ãƒ€ãƒ æ•°ã‚’ãƒŸãƒ³ãƒˆã•ã‚Œã‚‹ã¹ãæ®‹ã‚Šã® NFT æ•°ã§å‰°ä½™ã‚’å–ã‚‹ã“ã¨ã§é”æˆã•ã‚Œã€ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒ `availableTokenIds` é…åˆ—ã®ç¯„å›²å†…ã«ã‚ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚ä½¿ç”¨æ¸ˆã¿ã® `tokenIds` ã¯é…åˆ—ã®æœ€å¾Œã®è¦ç´ ã¨äº¤æ›ã•ã‚Œã€åˆ©ç”¨å¯èƒ½ãª `tokenIds` ã®ãƒªã‚¹ãƒˆã‚’ç¶­æŒã—ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨å…±ã«ç”Ÿæˆã•ã‚ŒãŸ `src/Counter.sol`ã€`test/Counter.t.sol`ã€`script/Counter.s.sol` ã¯å‰Šé™¤ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®æº–å‚™

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«`./env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ï¼š

```text
RPC_URL=https://artio.rpc.berachain.com/
ENTROPY_NFT_ADDRESS=YOUR_ENTROPY_NFT_ADDRESS
PRIVATE_KEY=YOUR_PRIVATE_KEY
ENTROPY_ADDRESS=0x26DD80569a8B23768A1d80869Ed7339e07595E85
PROVIDER_ADDRESS=0x6CC14824Ea2918f5De5C2f75A9Da968ad4BD6344
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã® `PRIVATE_KEY` ã‚’å…¥åŠ›ã—ã€ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼š

```terminal
# FROM: ./pyth-entropy

source .env;
```

### Berachain Testnet ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

ã¾ãšã€ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ï¼š

```terminal
# FROM: ./pyth-entropy

forge build;
```

`./out`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¤šãã®ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ãŒã‚ã‚‹ã“ã¨ã«æ°—ã¥ãã§ã—ã‚‡ã†ã€‚

Berachain Testnet ã«æ–°ã—ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã€`forge create`ã‚³ãƒãƒ³ãƒ‰ã‚’æ´»ç”¨ã™ã‚‹äºˆå®šã§ã™ï¼ˆã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ã®è©³ç´°ã¯[ã“ã¡ã‚‰](https://book.getfoundry.sh/reference/forge/forge-create?ref=berachain.ghost.io)ï¼‰ï¼š

```terminal
# FROM: ./pyth-entropy

forge create src/EntropyNFT.sol:EntropyNFT  \
--private-key $PRIVATE_KEY \
--rpc-url $RPC_URL \
--constructor-args $ENTROPY_ADDRESS $PROVIDER_ADDRESS;

# [Example output]
# Deployer: <YOUR_WALLET_ADDRESS>
# Deployed to: <YOUR_DEPLOYED_CONTRACT>
# Transaction hash: <CONTRACT_DEPLOYMENT_TX_HASH>
```

> `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `ENTROPY_NFT_ADDRESS` ã«ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
> ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹æ•°æ–™ã‚’æ”¯æ‰•ã†ã«ã¯$BERA ãŒå¿…è¦ã§ã™ã€‚ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆï¼ˆç„¡æ–™é…å¸ƒï¼‰ã®è³‡é‡‘ã¯https://artio.faucet.berachain.com/ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

### ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚ŒãŸ NFT ã®ãƒŸãƒ³ãƒˆ

ã•ã¦ã€JavaScript ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„ NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨å¯¾è©±ã—ã¾ã—ã‚‡ã†ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ ¼ç´ã™ã‚‹æ–°ã—ã„ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼ˆ2 ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼‰ï¼š

```terminal
# FROM ./pyth-entropy

mkdir app;
cd app;
touch requestMint.js;
```

./app/requestMint.js`ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ï¼š

```js
const { Web3 } = require("web3");
const EntropyNFTAbi = require("../out/EntropyNFT.sol/EntropyNFT.json");
const EntropyAbi = require("@pythnetwork/entropy-sdk-solidity/abis/IEntropy.json");
require("dotenv").config({ path: "../.env" });

async function requestMint() {
  // Step 1: initialize wallet & web3 contracts
  const web3 = new Web3(process.env["RPC_URL"]);
  const { address } = web3.eth.accounts.wallet.add(
    process.env["PRIVATE_KEY"]
  )[0];

  const entropyNFTContract = new web3.eth.Contract(
    EntropyNFTAbi.abi,
    process.env["ENTROPY_NFT_ADDRESS"]
  );

  const entropyContract = new web3.eth.Contract(
    EntropyAbi,
    process.env["ENTROPY_ADDRESS"]
  );

  // Step 2: generate user random number, request mint
  console.log("Generating user random number and commitment...");
  const userRandomNumber = web3.utils.randomHex(32);
  console.log(`User Random Number: ${userRandomNumber}`);

  console.log("Fetching request fee...");
  const fee = await entropyContract.methods
    .getFee(process.env["PROVIDER_ADDRESS"])
    .call();
  console.log(`Request Fee: ${fee}`);

  console.log("Requesting NFT mint...");
  const requestReceipt = await entropyNFTContract.methods
    .requestMint(userRandomNumber)
    .send({ value: fee, from: address });
  console.log(`Request Transaction Hash: ${requestReceipt.transactionHash}`);

  const sequenceNumber =
    requestReceipt.events.NumberRequested.returnValues.sequenceNumber;
  console.log(`Sequence Number: ${sequenceNumber}`);

  // Step 3: Poll for new Minted events emitted by EntropyNFT
  // Stops polling when same sequenceNumber is fulfilled
  const intervalId = setInterval(async () => {
    currentBlock = await web3.eth.getBlockNumber();

    const events = await entropyNFTContract.getPastEvents("Minted", {
      fromBlock: currentBlock - 5n,
      toBlock: currentBlock,
    });

    // Find the event with the same sequence number as the request.
    const event = events.find(
      (event) => event.returnValues.sequenceNumber === sequenceNumber
    );

    // If the event is found, log the result and stop polling.
    if (event !== undefined) {
      const values = events[0].returnValues;
      console.log(
        `âœ… NFT ID ${values.tokenId} minted to ${values.minter}, based on sequenceNumber ${values.sequenceNumber}`
      );
      clearInterval(intervalId);
    }
  }, 2000);
}

requestMint();
```

ã•ã‚ã€å®Ÿè¡Œã—ã¾ã—ã‚‡ã†:

```terminal
# FROM: ./pyth-entropy/app

node requestMint.js;

# [Expected Output]:
# Generating user random number and commitment...
# User Random Number: <0xUSER_RANDOM_NUMBER>
# Fetching request fee...
# Request Fee: 101
# Requesting NFT mint...
# Request Transaction Hash: <0xTX_HASH>
# Sequence Number: 116
# âœ… NFT ID 168 minted to <YOUR_WALLET_ADDRESS>, based on sequenceNumber 116
```

`requestMint`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä¸»ã« 2 ã¤ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

**ã‚¹ãƒ†ãƒƒãƒ— 1:** ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã¨ NFT ãŠã‚ˆã³ Entropy ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨å¯¾è©±ã™ã‚‹ãŸã‚ã® web3 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

**ã‚¹ãƒ†ãƒƒãƒ— 2:** ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ãŒç”Ÿæˆã•ã‚Œã€å¿…è¦ãªæ‰‹æ•°æ–™ã¨å…±ã«`EntropyNFT`ã®`requestMint`é–¢æ•°ã«æ¸¡ã•ã‚Œã¾ã™ã€‚ãã®è¦‹è¿”ã‚Šã¨ã—ã¦ã€Entropy ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰`sequenceNumber`ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

**ã‚¹ãƒ†ãƒƒãƒ— 3:** ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ãŸå¾Œã€è‡ªå‹•åŒ–ã•ã‚ŒãŸ Pyth ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆã—ã€NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®`entropyCallback`é–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®éƒ¨åˆ†ã¯ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®`Minted`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã—ã¾ã™ã€‚ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Entropy ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæº€ãŸã•ã‚Œã€ãã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ä½¿ç”¨ã—ã¦æ¤œè¨¼å¯èƒ½ãªãƒ©ãƒ³ãƒ€ãƒ  NFT ãŒã‚ãªãŸã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«ãƒŸãƒ³ãƒˆã•ã‚ŒãŸã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼Pyth ã® Entropy ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ´»ç”¨ã—ã¦ã€è¨¼æ˜å¯èƒ½ãªå…¬å¹³ãª NFT ãƒŸãƒ³ãƒˆãƒ—ãƒ­ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸ ğŸ‰

### Entropy ã®æ¦‚è¦ ğŸ”®

Pyth Entropy ã¯ã€ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®å¤å…¸çš„ãªã‚³ãƒŸãƒƒãƒˆ/ãƒªãƒ“ãƒ¼ãƒ«ã‚¹ã‚­ãƒ¼ãƒ ã‚’æ‹¡å¼µã—ã¦ã„ã¾ã™ã€‚ã¾ãšã€2 ã¤ã®å½“äº‹è€…ãŒå€‹åˆ¥ã«ç§˜å¯†ã®å€¤ï¼ˆç”Ÿæˆã•ã‚ŒãŸãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ï¼‰ã«ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚ãƒªãƒ“ãƒ¼ãƒ«ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€2 ã¤ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã®ãƒãƒƒã‚·ãƒ¥ã«åŸºã¥ã„ã¦æœ€çµ‚çš„ãªãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æ–‡è„ˆã§ã¯ã€ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã®ç”Ÿæˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ©Ÿèƒ½ã—ã€é–¢ä¸ã™ã‚‹ç•°ãªã‚‹å½“äº‹è€…ã«é‡ç‚¹ã‚’ç½®ã„ã¦ã„ã¾ã™ï¼š

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®`requestMint`å‘¼ã³å‡ºã—ã§ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã«ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™
2. ã‚ªãƒ•ãƒã‚§ãƒ¼ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒœãƒƒãƒˆï¼‰ãŒ 2 ç•ªç›®ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆã—ã¾ã™
3. ãƒœãƒƒãƒˆã¯ 2 ã¤ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ Pyth ã®`Entropy`ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«`revealWithCallBack`å‘¼ã³å‡ºã—ã‚’é€šã˜ã¦é€ä¿¡ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šæœ€çµ‚çš„ã«ã€NFT ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®`entropyCallback`ãŒå‘¼ã³å‡ºã•ã‚Œã€ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã•ã‚ŒãŸ NFT ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒŸãƒ³ãƒˆã•ã‚Œã¾ã™

**_æ³¨æ„ï¼š_** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦–ç‚¹ã‹ã‚‰ã¯ã€ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æœ€åˆã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ`requestMint`ï¼‰ã¯ NFT ã‚’ãƒŸãƒ³ãƒˆã—ã¾ã›ã‚“ã€‚ã‚€ã—ã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒœãƒƒãƒˆã«ã‚ˆã£ã¦é–‹å§‹ã•ã‚Œã‚‹å¾Œç¶šã®å‘¼ã³å‡ºã—ã§ NFT ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

å¤šãã®å‹•ãéƒ¨åˆ†ãŒã‚ã‚‹ã®ã§ã€ã“ã“ã«ç›¸äº’ä½œç”¨ã‚’åˆ†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¤ãƒ•ãƒ­ãƒ¼å›³ãŒã‚ã‚Šã¾ã™ï¼š

![](https://super-translator.inaridiy.workers.dev/assets/image/3860aa4e-f83a-43d7-a5a2-25198d8b91ba)
_Pyth Entropy Sequence Diagram_

> Entropy ã®è¨­è¨ˆã®è©³ç´°ã¯ã€[Pyth's docs](https://docs.pyth.network/entropy/protocol-design?ref=berachain.ghost.io)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ» Full Code Repository

æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã‚„ä»–ã®ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ãŸã„å ´åˆã¯ã€[**_Berachain Pyth Entropy Guide Code_**](https://github.com/berachain/guides/tree/main/apps/pyth-entropy?ref=berachain.ghost.io) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

https://github.com/berachain/guides/tree/main/apps/pyth-entropy?ref=berachain.ghost.io

---

### ğŸ› ï¸ ã•ã‚‰ã«é–‹ç™ºã‚’é€²ã‚ãŸã„ã§ã™ã‹ï¼Ÿ

Berachain ã§ã•ã‚‰ã«é–‹ç™ºã‚’é€²ã‚ãŸã„ã€ã‚ˆã‚Šå¤šãã®å®Ÿè£…ä¾‹ã‚’è¦‹ãŸã„ã¨ãŠè€ƒãˆã§ã™ã‹ï¼Ÿç§ãŸã¡[**_Berachain GitHub Guides Repo_**](https://github.com/berachain/guides?ref=berachain.ghost.io) ã‚’ãœã²ã”è¦§ãã ã•ã„ã€‚ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã€NextJSã€Hardhatã€Viemã€Foundry ãªã©ã€æ§˜ã€…ãªæŠ€è¡“ã‚’ä½¿ç”¨ã—ãŸå¹…åºƒã„å®Ÿè£…ä¾‹ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/berachain/guides/tree/main?ref=berachain.ghost.io

ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’æ¢æ±‚ã—ãŸã„å ´åˆã¯ã€[**_Berachain ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ_**](https://docs.berachain.com/?ref=berachain.ghost.io)ã‚’ã”è¦§ãã ã•ã„ã€‚

https://docs.berachain.com/?ref=berachain.ghost.io

### é–‹ç™ºè€…ã‚µãƒãƒ¼ãƒˆã‚’ãŠæ¢ã—ã§ã™ã‹ï¼Ÿ

è³ªå•ã‚’ã™ã‚‹ãŸã‚ã«ã€[**_Berachain Discord_**](https://discord.com/invite/berachain?ref=berachain.ghost.io)ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ã—ã€é–‹ç™ºè€…ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

â¤ï¸ ã“ã®è¨˜äº‹ã«å¯¾ã—ã¦æ„›ã‚’ç¤ºã™ã®ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ ğŸ‘ğŸ¼

---

---

:::note info
ã€Sunrise ã¨ã¯ã€‘
Sunrise ã¯ Proof of Liquidity(PoL)ã¨ Fee Abstractionï¼ˆæ‰‹æ•°æ–™æŠ½è±¡åŒ–ï¼‰ã‚’å‚™ãˆãŸãƒ‡ãƒ¼ã‚¿å¯ç”¨æ€§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚ ç§ãŸã¡ã¯ DA ã®ä½“é¨“ã‚’å†æ§‹ç¯‰ã—ã€å¤šæ§˜ãªã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼å‹æµå‹•æ€§ã‚’æ´»ç”¨ã—ã¦ãƒ­ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç«‹ã¡ä¸Šã’ã¦ã„ã¾ã™ã€‚

- [Sunrise - Specialized DA Layer for Proof of Liquidity](https://sunriselayer.io/)
- [Sunrise / Gluon Docs](https://docs.sunriselayer.io/)

ã€Social Linksã€‘

- [X(æ—§ Twitter)[è‹±èª])](https://twitter.com/SunriseLayer)
- [X(æ—§ Twitter)[æ—¥æœ¬èª])](https://twitter.com/SunriseLayer)
- [Discord Community](https://discord.com/invite/sunrise)
- [Medium](https://sunriselayer.medium.com/)
- [Github](https://github.com/sunriselayer)
- [Linkedin](https://www.linkedin.com/company/sunriselayer)

ã€ãŠå•åˆã›ã€‘
Sunrise ã¸ã®ãŠå•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰ã‹ã‚‰ ğŸ‘‰ [Google Form](https://forms.gle/h8RVahxRtXUvYwnv6)

![1080x360.jpeg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3839047/8971d83b-3331-4757-dc72-320d28618735.jpeg)

:::
